<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Forecasting Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Sales Forecasting with Time Series Analysis</h1>
            <p>Generate synthetic sales data and perform time series forecasting</p>
        </header>

        <div class="card" id="generator-card">
            <h2>Dataset Generator</h2>
            <form id="generate-form">
                <div class="form-group">
                    <label for="start_date">Start Date:</label>
                    <input type="date" id="start_date" name="start_date" value="2023-01-01" required>
                </div>
                
                <div class="form-group">
                    <label for="periods">Number of Days:</label>
                    <input type="number" id="periods" name="periods" min="30" max="1000" value="365" required>
                </div>
                
                <div class="form-group">
                    <label for="seasonality">Seasonality Pattern:</label>
                    <select id="seasonality" name="seasonality">
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Yearly</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="trend_strength">Trend Strength (0-1):</label>
                    <input type="range" id="trend_strength" name="trend_strength" min="0" max="1" step="0.1" value="0.5">
                    <span id="trend_value">0.5</span>
                </div>
                
                <div class="form-group">
                    <label for="noise_level">Noise Level (0-1):</label>
                    <input type="range" id="noise_level" name="noise_level" min="0" max="1" step="0.1" value="0.2">
                    <span id="noise_value">0.2</span>
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn-primary">Generate Dataset</button>
                    <button type="button" id="download-btn" class="btn-secondary" disabled>Download CSV</button>
                </div>
            </form>
            
            <div id="generate-status" class="status-message"></div>
            
            <div id="data-preview" class="preview-container hidden">
                <h3>Data Preview</h3>
                <div class="chart-container">
                    <img id="preview-chart" src="" alt="Data Preview">
                </div>
            </div>
        </div>
        
        <div class="card" id="forecast-card">
            <h2>Sales Forecasting</h2>
            <form id="forecast-form">
                <div class="form-group">
                    <label for="forecast_periods">Forecast Horizon (Days):</label>
                    <input type="number" id="forecast_periods" name="forecast_periods" min="1" max="180" value="30">
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn-primary" id="forecast-btn" disabled>Run Forecast</button>
                </div>
            </form>
            
            <div id="forecast-status" class="status-message"></div>
            
            <div id="forecast-results" class="results-container hidden">
                <h3>Forecast Results</h3>
                <div class="chart-container">
                    <img id="forecast-chart" src="" alt="Forecast Chart">
                </div>
                
                <div class="metrics-container">
                    <h4>Forecast Metrics</h4>
                    <div class="metrics-grid">
                        <div class="metric-box">
                            <h5>Mean Squared Error</h5>
                            <p id="mse-value">-</p>
                        </div>
                        <div class="metric-box">
                            <h5>Mean Absolute Error</h5>
                            <p id="mae-value">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Time Series Forecasting Mini Project</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Update sliders value display
            document.getElementById('trend_strength').addEventListener('input', function() {
                document.getElementById('trend_value').textContent = this.value;
            });
            
            document.getElementById('noise_level').addEventListener('input', function() {
                document.getElementById('noise_value').textContent = this.value;
            });
            
            // Handle dataset generation form submission
            document.getElementById('generate-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const statusElem = document.getElementById('generate-status');
                
                statusElem.textContent = 'Generating data...';
                statusElem.className = 'status-message working';
                
                fetch('/generate_dataset', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        statusElem.textContent = data.message;
                        statusElem.className = 'status-message success';
                        
                        // Enable download and forecast buttons
                        document.getElementById('download-btn').disabled = false;
                        document.getElementById('forecast-btn').disabled = false;
                        
                        // Show data preview
                        document.getElementById('data-preview').classList.remove('hidden');
                        document.getElementById('preview-chart').src = 'data:image/png;base64,' + data.preview;
                    } else {
                        statusElem.textContent = 'Error: ' + data.message;
                        statusElem.className = 'status-message error';
                    }
                })
                .catch(error => {
                    statusElem.textContent = 'Error: ' + error.message;
                    statusElem.className = 'status-message error';
                });
            });
            
            // Handle download button
            document.getElementById('download-btn').addEventListener('click', function() {
                window.location.href = '/download_dataset';
            });
            
            // Handle forecast form submission
            document.getElementById('forecast-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const statusElem = document.getElementById('forecast-status');
                
                statusElem.textContent = 'Running forecast...';
                statusElem.className = 'status-message working';
                
                fetch('/forecast', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        statusElem.textContent = 'Forecast completed successfully!';
                        statusElem.className = 'status-message success';
                        
                        // Show forecast results
                        document.getElementById('forecast-results').classList.remove('hidden');
                        document.getElementById('forecast-chart').src = 'data:image/png;base64,' + data.forecast_chart;
                        
                        // Update metrics
                        document.getElementById('mse-value').textContent = data.metrics.mse.toFixed(2);
                        document.getElementById('mae-value').textContent = data.metrics.mae.toFixed(2);
                    } else {
                        statusElem.textContent = 'Error: ' + data.message;
                        statusElem.className = 'status-message error';
                    }
                })
                .catch(error => {
                    statusElem.textContent = 'Error: ' + error.message;
                    statusElem.className = 'status-message error';
                });
            });
        });
    </script>
</body>
</html>
